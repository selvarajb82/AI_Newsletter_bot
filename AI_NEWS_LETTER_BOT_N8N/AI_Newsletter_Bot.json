{
  "name": "AI Newsletter Bot",
  "nodes": [
    {
      "parameters": {
        "trigger": [
          "message"
        ],
        "channelId": {
          "__rl": true,
          "value": "C0AGSJPEK4Z",
          "mode": "list",
          "cachedResultName": "all-newbot"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.slackTrigger",
      "typeVersion": 1,
      "position": [
        -960,
        -208
      ],
      "id": "53f36b55-0a5e-439c-96dc-09f5110f2a03",
      "name": "Slack Trigger",
      "webhookId": "8459356b-15f3-429f-b829-818d5b00d8a9",
      "credentials": {
        "slackApi": {
          "id": "zb68UBOY26rIAbom",
          "name": "NewsletterBot"
        }
      }
    },
    {
      "parameters": {
        "url": "https://serpapi.com/search",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "engine",
              "value": "google"
            },
            {
              "name": "q",
              "value": "={{ $json.topic }}"
            },
            {
              "name": "api_key",
              "value": "ea4a238da62c4c548accac1a15d7d8a2ae4eea569a0a41967a8198fbac35cd5a"
            },
            {
              "name": "num",
              "value": "8"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.4,
      "position": [
        -384,
        -208
      ],
      "id": "37978fb1-8539-4c98-a133-1ef6ca9cb59a",
      "name": "SerpAPI Search"
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "GPT-4O-MINI"
        },
        "responses": {
          "values": [
            {
              "content": "=Topic searched: {{ $json.topic }}\n\nRaw Google search results (JSON):\n\n{{ JSON.stringify($json, null, 2) }}"
            },
            {
              "role": "system",
              "content": "=You are an expert HTML designer creating clean, modern single-file reports.\nUse Tailwind CSS via CDN (include the script tag).\nMake it beautiful: cards, colors, responsive, professional look.\nTitle: Search Report: {{ $json.topic }}\n\nStructure:\n- Big header with topic\n- Short summary of key findings\n- Bulleted or numbered list of top results: title (bold), short snippet, clickable link (target=\"_blank\")\nOutput ONLY valid HTML code â€” nothing else."
            }
          ]
        },
        "builtInTools": {},
        "options": {
          "temperature": 0.7
        }
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 2.1,
      "position": [
        -176,
        -208
      ],
      "id": "82076cda-ed28-478e-a04d-b27bb82a04a8",
      "name": "Generate HTML Report",
      "credentials": {
        "openAiApi": {
          "id": "2lodxNUc0P23qu4a",
          "name": "OpenAi account 2"
        }
      }
    },
    {
      "parameters": {
        "operation": "toText",
        "sourceProperty": "formattedHtml",
        "options": {
          "fileName": "={{ $json.filename }}"
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        384,
        -208
      ],
      "id": "a193919b-4648-4205-90bd-52c07e7737ee",
      "name": "Convert to File"
    },
    {
      "parameters": {
        "jsCode": "// DEBUG: Check what data is reaching Slack\nconst inputData = $input.first().json;\n\nconsole.log('=== DATA GOING TO SLACK ===');\nconsole.log('Keys:', Object.keys(inputData));\nconsole.log('Message preview:', inputData.slackMessage?.substring(0, 200));\n\n// Check if any field contains HTML\nconst htmlFields = [];\nObject.entries(inputData).forEach(([key, value]) => {\n  if (typeof value === 'string' && \n      (value.includes('<html') || value.includes('<!DOCTYPE') || value.includes('<div'))) {\n    htmlFields.push(key);\n    console.log(`âš ï¸ HTML detected in field: ${key}`);\n  }\n});\n\nif (htmlFields.length > 0) {\n  console.log('WARNING: HTML content found in these fields:', htmlFields.join(', '));\n} else {\n  console.log('âœ… No HTML detected - good to go!');\n}\n\nreturn [{\n  json: inputData\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1008,
        160
      ],
      "id": "cc3727a1-b8de-4489-9f05-813218e75bb1",
      "name": "debugforslack"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "f622f3f9-09e8-467a-97c3-aa017bc9b11e",
              "name": "topic",
              "value": "={{$json[\"text\"]}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -624,
        -208
      ],
      "id": "5736d95c-711d-4f5a-96d0-9a1cda7028f1",
      "name": "Input question from slack"
    },
    {
      "parameters": {
        "jsCode": "// Get the Slack message from the nested structure\nconst slackData = $json['Stack Trigger'] || $json;\n\n// Your bot's identifiers\nconst BOT_ID = 'B0AGNE6VAJ';\nconst BOT_USER_ID = 'U0AH814SA80';\n\n// Check if this is a bot message\nconst isBot = slackData.bot_id === BOT_ID || \n              slackData.user === BOT_USER_ID ||\n              slackData.subtype === 'bot_message';\n\n// If it's from a bot, stop execution\nif (isBot) {\n  console.log('Ignoring bot message, stopping workflow');\n  return []; // Empty array stops the workflow\n}\n\n// If it's a real user message, continue with the Slack data at root\nreturn [{\n  json: {\n    ...slackData,\n    isUserMessage: true,\n    topic: $json.topic // Keep the topic if it exists\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -800,
        -208
      ],
      "id": "f3e27b6e-900b-4806-b453-f336790d81cf",
      "name": "stop here if it bot run"
    },
    {
      "parameters": {
        "jsCode": "// Get the input data\nconst inputData = $input.first().json;\n\n// Navigate to the HTML content\n// Path: output[0].content[0].text\nlet htmlContent = null;\n\ntry {\n  // Check if output exists and is an array\n  if (inputData.output && Array.isArray(inputData.output) && inputData.output.length > 0) {\n    const firstOutput = inputData.output[0];\n    \n    // Check if content exists and is an array\n    if (firstOutput.content && Array.isArray(firstOutput.content) && firstOutput.content.length > 0) {\n      const firstContent = firstOutput.content[0];\n      \n      // Get the text field which contains the HTML\n      if (firstContent.text) {\n        htmlContent = firstContent.text;\n        console.log('Found HTML in output[0].content[0].text');\n      }\n    }\n  }\n  \n  // If the above path didn't work, try alternative paths\n  if (!htmlContent) {\n    // Try direct access\n    htmlContent = inputData.output?.[0]?.content?.[0]?.text;\n  }\n  \n  // If still not found, try a recursive search\n  if (!htmlContent) {\n    function findTextWithHtml(obj) {\n      if (!obj || typeof obj !== 'object') return null;\n      \n      if (typeof obj === 'string' && obj.includes('<html')) {\n        return obj;\n      }\n      \n      if (Array.isArray(obj)) {\n        for (const item of obj) {\n          const found = findTextWithHtml(item);\n          if (found) return found;\n        }\n      } else {\n        for (const key in obj) {\n          const found = findTextWithHtml(obj[key]);\n          if (found) return found;\n        }\n      }\n      return null;\n    }\n    \n    htmlContent = findTextWithHtml(inputData);\n  }\n  \n} catch (error) {\n  console.log('Error extracting HTML:', error.message);\n}\n\n// If we still don't have HTML, show error\nif (!htmlContent) {\n  return [{\n    json: {\n      error: 'Could not find HTML content',\n      structure: Object.keys(inputData),\n      preview: JSON.stringify(inputData).substring(0, 500)\n    }\n  }];\n}\n\n// Clean up the HTML content first\nlet cleanHtml = htmlContent\n  .replace(/```html\\n?/g, '')  // Remove markdown code blocks\n  .replace(/```\\n?/g, '')\n  .replace(/\\\\n/g, '\\n')        // Replace escaped newlines with actual newlines\n  .replace(/\\\\\"/g, '\"')         // Replace escaped quotes\n  .replace(/\\\\t/g, '\\t')\n  .replace(/\\\\r/g, '\\r')\n  .trim();\n\n// Get topic from Slack message\nconst slackMessage = $node['Slack Trigger'].json.text || 'report';\nconst cleanTopic = slackMessage\n  .toLowerCase()\n  .replace(/[^a-z0-9]+/g, '-')\n  .replace(/^-|-$/g, '') || 'report';\n\n// Check if the content already has HTML structure\nconst hasHtmlTag = cleanHtml.includes('<html') || cleanHtml.includes('<body');\nconst hasDoctype = cleanHtml.includes('<!DOCTYPE html>');\n\n// Extract just the body content if it exists, otherwise use the whole thing\nlet bodyContent = cleanHtml;\nif (hasHtmlTag) {\n  // Try to extract just the content between body tags\n  const bodyMatch = cleanHtml.match(/<body[^>]*>([\\s\\S]*?)<\\/body>/i);\n  if (bodyMatch && bodyMatch[1]) {\n    bodyContent = bodyMatch[1];\n  } else {\n    // If no body tags, try to get content after head\n    const afterHeadMatch = cleanHtml.replace(/<head[^>]*>[\\s\\S]*?<\\/head>/i, '');\n    bodyContent = afterHeadMatch;\n  }\n}\n\n// Create a beautiful, modern HTML template with enhanced styling\nconst styledHtml = `<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>${cleanTopic.replace(/-/g, ' ')} | Interactive Report</title>\n    \n    <!-- Google Fonts for better typography -->\n    <link rel=\"preconnect\" href=\"https://fonts.googleapis.com\">\n    <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossorigin>\n    <link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap\" rel=\"stylesheet\">\n    \n    <!-- Font Awesome for icons -->\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css\">\n    \n    <style>\n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n        \n        body {\n            font-family: 'Inter', sans-serif;\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            min-height: 100vh;\n            padding: 2rem 1rem;\n            line-height: 1.6;\n            color: #2d3748;\n        }\n        \n        .container {\n            max-width: 1200px;\n            margin: 0 auto;\n            background: rgba(255, 255, 255, 0.95);\n            backdrop-filter: blur(10px);\n            border-radius: 20px;\n            box-shadow: 0 20px 60px rgba(0,0,0,0.3);\n            overflow: hidden;\n            animation: slideIn 0.6s ease-out;\n        }\n        \n        @keyframes slideIn {\n            from {\n                opacity: 0;\n                transform: translateY(30px);\n            }\n            to {\n                opacity: 1;\n                transform: translateY(0);\n            }\n        }\n        \n        /* Header Section */\n        .report-header {\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            color: white;\n            padding: 2.5rem;\n            position: relative;\n            overflow: hidden;\n        }\n        \n        .report-header::before {\n            content: '';\n            position: absolute;\n            top: -50%;\n            right: -50%;\n            width: 200%;\n            height: 200%;\n            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);\n            animation: rotate 20s linear infinite;\n        }\n        \n        @keyframes rotate {\n            from { transform: rotate(0deg); }\n            to { transform: rotate(360deg); }\n        }\n        \n        .report-header h1 {\n            font-family: 'Poppins', sans-serif;\n            font-size: 2.5rem;\n            font-weight: 700;\n            margin-bottom: 0.5rem;\n            position: relative;\n            z-index: 1;\n            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);\n        }\n        \n        .report-header .meta {\n            display: flex;\n            gap: 2rem;\n            margin-top: 1rem;\n            position: relative;\n            z-index: 1;\n            flex-wrap: wrap;\n        }\n        \n        .report-header .meta-item {\n            display: flex;\n            align-items: center;\n            gap: 0.5rem;\n            background: rgba(255,255,255,0.2);\n            padding: 0.5rem 1rem;\n            border-radius: 50px;\n            backdrop-filter: blur(5px);\n            font-size: 0.9rem;\n        }\n        \n        .report-header .meta-item i {\n            font-size: 1rem;\n        }\n        \n        /* Content Area */\n        .report-content {\n            padding: 2.5rem;\n            background: white;\n        }\n        \n        /* Modern Table Styling */\n        table {\n            width: 100%;\n            border-collapse: separate;\n            border-spacing: 0;\n            margin: 1.5rem 0;\n            background: white;\n            border-radius: 12px;\n            overflow: hidden;\n            box-shadow: 0 4px 6px rgba(0,0,0,0.05);\n            transition: all 0.3s ease;\n        }\n        \n        table:hover {\n            box-shadow: 0 8px 15px rgba(0,0,0,0.1);\n        }\n        \n        th {\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            color: white;\n            font-weight: 600;\n            padding: 1rem;\n            text-align: left;\n            font-size: 0.95rem;\n            letter-spacing: 0.5px;\n            position: relative;\n        }\n        \n        td {\n            padding: 1rem;\n            border-bottom: 1px solid #edf2f7;\n            color: #4a5568;\n            transition: all 0.3s ease;\n        }\n        \n        /* Zebra striping with gradient */\n        tbody tr:nth-child(odd) {\n            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);\n        }\n        \n        tbody tr:nth-child(even) {\n            background: linear-gradient(135deg, #ffffff 0%, #f1f5f9 100%);\n        }\n        \n        /* Hover effects for rows */\n        tbody tr:hover {\n            background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%);\n            transform: scale(1.01);\n            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);\n            cursor: pointer;\n        }\n        \n        /* Hover effects for cells */\n        td:hover {\n            background: rgba(255, 255, 255, 0.5);\n            font-weight: 500;\n            color: #4c51bf;\n        }\n        \n        /* Column-specific hover (enhanced) */\n        td:nth-child(1):hover {\n            background: linear-gradient(135deg, #ffe5e5, #ffb8b8);\n        }\n        \n        td:nth-child(2):hover {\n            background: linear-gradient(135deg, #e5ffe5, #b8ffb8);\n        }\n        \n        td:nth-child(3):hover {\n            background: linear-gradient(135deg, #e5e5ff, #b8b8ff);\n        }\n        \n        td:nth-child(4):hover {\n            background: linear-gradient(135deg, #fff0e5, #ffd8b8);\n        }\n        \n        /* Smooth transitions for all interactive elements */\n        th, td, tr, .card, button {\n            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n        }\n        \n        /* Card styling for sections */\n        .section-card {\n            background: linear-gradient(135deg, #ffffff, #f8fafc);\n            border-radius: 16px;\n            padding: 1.5rem;\n            margin: 1.5rem 0;\n            box-shadow: 0 4px 6px rgba(0,0,0,0.05);\n            border: 1px solid rgba(102, 126, 234, 0.1);\n            transition: all 0.3s ease;\n        }\n        \n        .section-card:hover {\n            box-shadow: 0 8px 15px rgba(102, 126, 234, 0.2);\n            transform: translateY(-2px);\n            border-color: #667eea;\n        }\n        \n        .section-card h2 {\n            font-family: 'Poppins', sans-serif;\n            color: #2d3748;\n            margin-bottom: 1rem;\n            font-size: 1.8rem;\n            background: linear-gradient(135deg, #667eea, #764ba2);\n            -webkit-background-clip: text;\n            -webkit-text-fill-color: transparent;\n            display: inline-block;\n        }\n        \n        /* List styling */\n        ul, ol {\n            padding-left: 1.5rem;\n            margin: 1rem 0;\n        }\n        \n        li {\n            margin: 0.75rem 0;\n            padding: 0.5rem 1rem;\n            background: #f8fafc;\n            border-radius: 8px;\n            border-left: 4px solid #667eea;\n            transition: all 0.3s ease;\n        }\n        \n        li:hover {\n            transform: translateX(5px);\n            background: #e0e7ff;\n            border-left-color: #764ba2;\n        }\n        \n        /* Link styling */\n        a {\n            color: #667eea;\n            text-decoration: none;\n            font-weight: 500;\n            position: relative;\n            transition: all 0.3s ease;\n        }\n        \n        a::after {\n            content: '';\n            position: absolute;\n            bottom: -2px;\n            left: 0;\n            width: 0;\n            height: 2px;\n            background: linear-gradient(90deg, #667eea, #764ba2);\n            transition: width 0.3s ease;\n        }\n        \n        a:hover {\n            color: #764ba2;\n        }\n        \n        a:hover::after {\n            width: 100%;\n        }\n        \n        /* Badge styling */\n        .badge {\n            display: inline-block;\n            padding: 0.35rem 0.75rem;\n            border-radius: 50px;\n            font-size: 0.8rem;\n            font-weight: 600;\n            letter-spacing: 0.5px;\n            background: linear-gradient(135deg, #f0f0f0, #e0e0e0);\n            color: #2d3748;\n            transition: all 0.3s ease;\n        }\n        \n        .badge-success {\n            background: linear-gradient(135deg, #c6f6d5, #9ae6b4);\n            color: #22543d;\n        }\n        \n        .badge-warning {\n            background: linear-gradient(135deg, #feebc8, #fbd38d);\n            color: #744210;\n        }\n        \n        .badge-info {\n            background: linear-gradient(135deg, #bee3f8, #90cdf4);\n            color: #1a365d;\n        }\n        \n        .badge:hover {\n            transform: scale(1.05);\n            filter: brightness(1.1);\n        }\n        \n        /* Footer */\n        .report-footer {\n            background: #f8fafc;\n            padding: 1.5rem 2.5rem;\n            text-align: center;\n            border-top: 1px solid #edf2f7;\n            color: #718096;\n            font-size: 0.9rem;\n        }\n        \n        .report-footer i {\n            color: #667eea;\n            margin: 0 0.25rem;\n        }\n        \n        /* Responsive design */\n        @media (max-width: 768px) {\n            .container {\n                border-radius: 12px;\n            }\n            \n            .report-header {\n                padding: 1.5rem;\n            }\n            \n            .report-header h1 {\n                font-size: 1.8rem;\n            }\n            \n            .report-header .meta {\n                gap: 1rem;\n            }\n            \n            .report-content {\n                padding: 1.5rem;\n            }\n            \n            table {\n                display: block;\n                overflow-x: auto;\n                white-space: nowrap;\n            }\n            \n            th, td {\n                min-width: 120px;\n            }\n        }\n        \n        /* Animation for content load */\n        .fade-in {\n            animation: fadeIn 0.5s ease-in;\n        }\n        \n        @keyframes fadeIn {\n            from { opacity: 0; transform: translateY(10px); }\n            to { opacity: 1; transform: translateY(0); }\n        }\n        \n        /* Stats cards */\n        .stats-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n            gap: 1.5rem;\n            margin: 2rem 0;\n        }\n        \n        .stat-card {\n            background: linear-gradient(135deg, #ffffff, #f8fafc);\n            border-radius: 12px;\n            padding: 1.5rem;\n            text-align: center;\n            box-shadow: 0 4px 6px rgba(0,0,0,0.05);\n            border: 1px solid #e2e8f0;\n            transition: all 0.3s ease;\n        }\n        \n        .stat-card:hover {\n            transform: translateY(-5px);\n            box-shadow: 0 8px 15px rgba(102, 126, 234, 0.2);\n        }\n        \n        .stat-card i {\n            font-size: 2.5rem;\n            color: #667eea;\n            margin-bottom: 1rem;\n        }\n        \n        .stat-card .stat-value {\n            font-size: 2rem;\n            font-weight: 700;\n            color: #2d3748;\n            margin: 0.5rem 0;\n        }\n        \n        .stat-card .stat-label {\n            color: #718096;\n            font-size: 0.9rem;\n            text-transform: uppercase;\n            letter-spacing: 1px;\n        }\n    </style>\n</head>\n<body>\n    <div class=\"container fade-in\">\n        <header class=\"report-header\">\n            <h1><i class=\"fas fa-chart-line\" style=\"margin-right: 1rem;\"></i>${cleanTopic.replace(/-/g, ' ')}</h1>\n            <div class=\"meta\">\n                <span class=\"meta-item\">\n                    <i class=\"far fa-calendar-alt\"></i> ${new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}\n                </span>\n                <span class=\"meta-item\">\n                    <i class=\"far fa-clock\"></i> ${new Date().toLocaleTimeString()}\n                </span>\n                <span class=\"meta-item\">\n                    <i class=\"fas fa-chart-pie\"></i> Interactive Report\n                </span>\n            </div>\n        </header>\n        \n        <div class=\"report-content\">\n            <!-- Insert the processed content with enhanced styling -->\n            ${bodyContent}\n        </div>\n        \n        <footer class=\"report-footer\">\n            <p>\n                <i class=\"fas fa-bolt\"></i> Generated with n8n automation \n                <i class=\"fas fa-heart\" style=\"color: #f56565;\"></i> | \n                <i class=\"fas fa-code-branch\"></i> Version 2.0 |\n                <i class=\"fas fa-database\"></i> Data powered by SerpAPI & OpenAI\n            </p>\n        </footer>\n    </div>\n</body>\n</html>`;\n\n// Return the formatted HTML\nreturn [{\n  json: {\n    formattedHtml: styledHtml,\n    topic: cleanTopic,\n    filename: `${cleanTopic}.html`,\n    preview: styledHtml.substring(0, 300) + '...',\n    lineCount: styledHtml.split('\\n').length,\n    charCount: styledHtml.length,\n    extractedFrom: 'output[0].content[0].text (enhanced with styling)'\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        176,
        -208
      ],
      "id": "fbcd92c9-70ea-4758-94db-04e1fc696853",
      "name": "generate HTML Report"
    },
    {
      "parameters": {
        "jsCode": "// Get the input data\nconst inputData = $input.first();\n\n// Get the binary data\nconst binaryData = inputData.binary?.data;\n\n// Get the filename from the binary data itself\nconst filename = binaryData?.fileName || 'report.html';\n\n// Get topic from the binary data or use a default\nconst topic = filename.replace('.html', '').replace(/-/g, ' ');\n\n// Return both JSON and binary data\nreturn [{\n  json: {\n    filename: filename,\n    topic: topic,\n    // Add any other metadata you need\n    generatedAt: new Date().toISOString()\n  },\n  binary: {\n    data: binaryData  // Pass through the binary data\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        592,
        -208
      ],
      "id": "78eafc33-99a8-494e-895d-d75a64261a86",
      "name": "Input for google Drive"
    },
    {
      "parameters": {
        "jsCode": "// Debug node to verify structure before Google Drive\nconst inputData = $input.first();\n\nconsole.log('JSON filename:', inputData.json.filename);\nconsole.log('Binary filename:', inputData.binary?.data?.fileName);\nconsole.log('Binary mime type:', inputData.binary?.data?.mimeType);\n\nreturn [{\n  json: inputData.json,\n  binary: inputData.binary\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        816,
        -96
      ],
      "id": "05c2b480-4b56-49d3-a789-7ff112bef814",
      "name": "debug if fails b4 drive"
    },
    {
      "parameters": {
        "name": "={{ $json.filename }}",
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "value": "1cnpDa13Nt8AE3O90vNcWkL9mmI35-Nwt",
          "mode": "id"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        1088,
        -96
      ],
      "id": "47e04d74-2332-44c0-834d-18b5bc58c86b",
      "name": "Google Drive  HTML file upload",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "FND2sz4LqwH032vN",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Get the Google Drive upload response\nconst driveOutput = $input.first().json;\n\n// Extract topic from filename\nconst filename = driveOutput.name || 'report.html';\nconst topic = filename\n  .replace('.html', '')\n  .replace(/-/g, ' ')\n  .replace(/\\b\\w/g, l => l.toUpperCase()); // Capitalize words\n\n// Create shareable links\nconst fileId = driveOutput.id;\nconst viewLink = driveOutput.webViewLink || `https://drive.google.com/file/d/${fileId}/view`;\nconst downloadLink = driveOutput.webContentLink || `https://drive.google.com/uc?export=download&id=${fileId}`;\n\n// Format message for Slack\nconst slackMessage = \n`âœ… *HTML Report Generated: ${topic}*\n\nðŸ“„ *File:* ${filename}\nðŸ“Š *Size:* ${((driveOutput.size || 0) / 1024).toFixed(2)} KB\n\nðŸ”— *View in Google Drive:*\n${viewLink}\n\nðŸ“¥ *Direct Download:*\n${downloadLink}\n\n_Generated at ${new Date().toLocaleString()}_`;\n\nreturn [{\n  json: {\n    viewLink: viewLink,\n    downloadLink: downloadLink,\n    topic: topic,\n    filename: filename,\n    slackMessage: slackMessage\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1424,
        -96
      ],
      "id": "88acdd42-eaed-45fa-ab23-aba7c2cc6525",
      "name": "generate information for Slack"
    },
    {
      "parameters": {
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "C0AGSJPEK4Z",
          "mode": "list",
          "cachedResultName": "all-newbot"
        },
        "text": "={{ $json.slackMessage }}",
        "otherOptions": {}
      },
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.4,
      "position": [
        -816,
        304
      ],
      "id": "a7d7dea3-0f20-4a5e-afa3-c30eee85aad5",
      "name": "Slack- Final output with download option",
      "webhookId": "b6f3af16-cd65-4fff-bbbf-ea92a3cf32e3",
      "credentials": {
        "slackApi": {
          "id": "zb68UBOY26rIAbom",
          "name": "NewsletterBot"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Get the data from your Slack preparation node\nconst inputData = $input.first().json;\n\n// Get Google Drive data from the upload node\nlet googleDriveData = {};\ntry {\n    // Use the exact name of your Google Drive node\n    googleDriveData = $node['Google Drive HTML file upload'].json || {};\n    console.log('âœ… Successfully got Google Drive data');\n} catch (error) {\n    console.log('âš ï¸ Could not get Google Drive node data, using input data instead');\n}\n\n// Log what we're working with (for debugging)\nconsole.log('Input data keys:', Object.keys(inputData));\nconsole.log('Google Drive keys:', Object.keys(googleDriveData));\n\n// CRITICAL: Get the file ID - this is the most important part\n// First try from Google Drive node, then from input data\nconst fileId = googleDriveData.id || inputData.id || '';\n\n// Get filename - try multiple possible field names\nconst filename = googleDriveData.originalFilename || \n                 googleDriveData.name || \n                 inputData.filename || \n                 'report.html';\n\n// Get file size and convert to KB\nconst fileSize = parseInt(googleDriveData.size || inputData.size || '0');\nconst sizeKB = (fileSize / 1024).toFixed(2);\n\n// Extract topic from filename (remove .html and replace hyphens with spaces)\nlet topic = filename\n    .replace('.html', '')\n    .replace(/-/g, ' ')\n    .split(' ')\n    .map(word => word.charAt(0).toUpperCase() + word.slice(1))\n    .join(' ');\n\n// If topic is empty, use a default\nif (!topic || topic === ' ') {\n    topic = 'HTML Report';\n}\n\n// Construct working Google Drive links\nconst viewLink = fileId ? `https://drive.google.com/file/d/${fileId}/view?usp=sharing` : '#';\nconst downloadLink = fileId ? `https://drive.google.com/uc?export=download&id=${fileId}&confirm=t` : '#';\n\n// Get current date and time\nconst now = new Date();\nconst dateStr = now.toLocaleDateString('en-US', { \n    year: 'numeric', \n    month: 'long', \n    day: 'numeric' \n});\n\n// Create beautifully formatted HTML email\nconst emailHtml = `<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>HTML Report: ${topic}</title>\n    <style>\n        body {\n            margin: 0;\n            padding: 0;\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            min-height: 100vh;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            padding: 20px;\n        }\n        .email-card {\n            max-width: 500px;\n            width: 100%;\n            background: white;\n            border-radius: 24px;\n            overflow: hidden;\n            box-shadow: 0 20px 60px rgba(0,0,0,0.3);\n            animation: slideIn 0.5s ease-out;\n        }\n        @keyframes slideIn {\n            from { transform: translateY(30px); opacity: 0; }\n            to { transform: translateY(0); opacity: 1; }\n        }\n        .header {\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            padding: 40px 30px;\n            text-align: center;\n        }\n        .header h1 {\n            color: white;\n            margin: 0;\n            font-size: 28px;\n            font-weight: 600;\n            letter-spacing: -0.5px;\n        }\n        .header p {\n            color: rgba(255,255,255,0.9);\n            margin: 10px 0 0;\n            font-size: 16px;\n        }\n        .content {\n            padding: 30px;\n        }\n        .info-box {\n            background: #f8fafc;\n            border-radius: 16px;\n            padding: 20px;\n            margin-bottom: 25px;\n            border: 1px solid #e2e8f0;\n        }\n        .info-row {\n            display: flex;\n            align-items: center;\n            padding: 8px 0;\n            border-bottom: 1px solid #edf2f7;\n        }\n        .info-row:last-child {\n            border-bottom: none;\n        }\n        .info-label {\n            width: 80px;\n            font-weight: 600;\n            color: #4a5568;\n        }\n        .info-value {\n            flex: 1;\n            color: #2d3748;\n            word-break: break-word;\n        }\n        .button-group {\n            display: flex;\n            gap: 15px;\n            margin: 25px 0;\n            flex-wrap: wrap;\n        }\n        .button {\n            flex: 1;\n            min-width: 200px;\n            padding: 14px 20px;\n            border-radius: 12px;\n            text-decoration: none;\n            font-weight: 600;\n            font-size: 16px;\n            text-align: center;\n            transition: all 0.3s ease;\n            display: inline-block;\n        }\n        .button-primary {\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            color: white;\n            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);\n        }\n        .button-primary:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);\n        }\n        .button-secondary {\n            background: white;\n            color: #667eea;\n            border: 2px solid #667eea;\n        }\n        .button-secondary:hover {\n            background: #f0f4ff;\n            transform: translateY(-2px);\n        }\n        .footer {\n            background: #f8fafc;\n            padding: 20px;\n            text-align: center;\n            border-top: 1px solid #e2e8f0;\n            color: #718096;\n            font-size: 13px;\n        }\n        .fallback-links {\n            background: #f1f5f9;\n            border-radius: 8px;\n            padding: 15px;\n            margin-top: 20px;\n            font-size: 12px;\n            word-break: break-all;\n        }\n        .fallback-links a {\n            color: #667eea;\n            text-decoration: none;\n        }\n        .fallback-links a:hover {\n            text-decoration: underline;\n        }\n    </style>\n</head>\n<body>\n    <div class=\"email-card\">\n        <div class=\"header\">\n            <h1>ðŸ“Š HTML Report</h1>\n            <p>Your requested report is ready</p>\n        </div>\n        \n        <div class=\"content\">\n            <div class=\"info-box\">\n                <div class=\"info-row\">\n                    <span class=\"info-label\">Topic</span>\n                    <span class=\"info-value\"><strong>${topic}</strong></span>\n                </div>\n                <div class=\"info-row\">\n                    <span class=\"info-label\">File</span>\n                    <span class=\"info-value\">${filename}</span>\n                </div>\n                <div class=\"info-row\">\n                    <span class=\"info-label\">Size</span>\n                    <span class=\"info-value\">${sizeKB} KB</span>\n                </div>\n                <div class=\"info-row\">\n                    <span class=\"info-label\">Date</span>\n                    <span class=\"info-value\">${dateStr}</span>\n                </div>\n            </div>\n            \n            <div class=\"button-group\">\n                <a href=\"${viewLink}\" class=\"button button-primary\" target=\"_blank\">ðŸ“„ View in Drive</a>\n                <a href=\"${downloadLink}\" class=\"button button-secondary\" target=\"_blank\">ðŸ“¥ Download</a>\n            </div>\n            \n            <div class=\"fallback-links\">\n                <p style=\"margin:0 0 8px; color:#4a5568;\"><strong>ðŸ”— Direct links:</strong></p>\n                <p style=\"margin:5px 0;\">ðŸ“„ View: <a href=\"${viewLink}\">${viewLink}</a></p>\n                <p style=\"margin:5px 0;\">ðŸ“¥ Download: <a href=\"${downloadLink}\">${downloadLink}</a></p>\n            </div>\n        </div>\n        \n        <div class=\"footer\">\n            <p style=\"margin:0;\">âœ¨ Generated by n8n automation</p>\n            <p style=\"margin:5px 0 0; font-size:11px;\">File saved in Google Drive folder: Slack</p>\n        </div>\n    </div>\n</body>\n</html>`;\n\n// Return properly formatted data for Gmail node\nreturn [{\n    json: {\n        to: 'selva.ai.solutions@gmail.com',\n        subject: `ðŸ“Š HTML Report: ${topic} - ${dateStr}`,\n        html: emailHtml,  // Make sure this field is named 'html'\n        // Also include plain text version for email clients that don't support HTML\n        text: `HTML Report: ${topic}\\n\\nFile: ${filename}\\nSize: ${sizeKB} KB\\n\\nView: ${viewLink}\\nDownload: ${downloadLink}`,\n        // Pass through data\n        viewLink: viewLink,\n        downloadLink: downloadLink,\n        filename: filename,\n        topic: topic\n    }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -608,
        304
      ],
      "id": "0f00a113-5649-4c79-92b6-75d21e7e1510",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "sendTo": "selva.ai.solutions@gmail.com",
        "subject": "={{ $json.subject }}",
        "message": "={{ $json.html }}",
        "options": {}
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.2,
      "position": [
        -400,
        304
      ],
      "id": "eb3220a1-082d-4c46-bae7-a35eacdee2e9",
      "name": "Send a message",
      "webhookId": "8b416847-a9d1-4041-ab98-ca32325c2d91",
      "credentials": {
        "gmailOAuth2": {
          "id": "HITG37yeTWpG7bKh",
          "name": "Gmail account"
        }
      }
    }
  ],
  "pinData": {
    "Code in JavaScript": [
      {
        "json": {
          "name": "First item",
          "code": 1
        }
      },
      {
        "json": {
          "name": "Second item",
          "code": 2
        }
      }
    ]
  },
  "connections": {
    "Slack Trigger": {
      "main": [
        [
          {
            "node": "stop here if it bot run",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SerpAPI Search": {
      "main": [
        [
          {
            "node": "Generate HTML Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate HTML Report": {
      "main": [
        [
          {
            "node": "generate HTML Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File": {
      "main": [
        [
          {
            "node": "Input for google Drive",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "debugforslack": {
      "main": [
        [
          {
            "node": "Slack- Final output with download option",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Input question from slack": {
      "main": [
        [
          {
            "node": "SerpAPI Search",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "stop here if it bot run": {
      "main": [
        [
          {
            "node": "Input question from slack",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "generate HTML Report": {
      "main": [
        [
          {
            "node": "Convert to File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Input for google Drive": {
      "main": [
        [
          {
            "node": "debug if fails b4 drive",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "debug if fails b4 drive": {
      "main": [
        [
          {
            "node": "Google Drive  HTML file upload",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Drive  HTML file upload": {
      "main": [
        [
          {
            "node": "generate information for Slack",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "generate information for Slack": {
      "main": [
        [
          {
            "node": "debugforslack",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Slack- Final output with download option": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Send a message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "binaryMode": "separate",
    "availableInMCP": false
  },
  "versionId": "f377a4b5-3872-40e4-903f-f08bb38c5175",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "6681a547bda1dc5a14e58187dabeb4ef3bc204b4006a1b2aab47879456c3722d"
  },
  "id": "8wWJneRWaoWQ2cUc",
  "tags": []
}